---
import { getOffre, getImageUrl } from '../../backend.mjs';
import Layout  from '../../layouts/Layout.astro';

const { id } = Astro.params;
const offre = await getOffre(id);

let imageUrls = [];
if (offre?.images) {
  for (const img of offre.images) {
    const url = await getImageUrl(offre, img);
    imageUrls.push(url);
  }
}
---

<Layout titre={offre?.nomMaison}>
  <div class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <button onclick="history.back()" class="mb-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">← Retour</button>
      
      <div class="flex flex-wrap -mx-4">
        <!-- Product Images -->
        <div class="w-full md:w-1/2 px-4 mb-8">
          {imageUrls.length > 0 ? (
            <>
              <img src={imageUrls[0]} alt={offre?.nomMaison}
                class="w-full h-auto rounded-lg shadow-md mb-4" id="mainImage">
              {imageUrls.length > 1 && (
                <div class="flex gap-4 py-4 justify-center overflow-x-auto">
                  {imageUrls.map((url) => (
                    <img src={url} alt={offre.nomMaison}
                      class="size-16 sm:size-20 object-cover rounded-md cursor-pointer opacity-60 hover:opacity-100 transition duration-300"
                      onclick={`changeImage('${url}')`}>
                  ))}
                </div>
              )}
            </>
          ) : (
            <div class="w-full h-96 bg-gray-200 rounded-lg shadow-md flex items-center justify-center">
              <span class="text-gray-400">Aucune image disponible</span>
            </div>
          )}
        </div>

        <!-- Product Details -->
        <div class="w-full md:w-1/2 px-4">
          <h2 class="text-3xl font-bold mb-2">{offre?.nomMaison}</h2>
          <p class="text-gray-600 mb-4">{offre?.adresse}</p>
          
          {offre?.prix && (
            <div class="mb-4">
              <span class="text-2xl font-bold mr-2">{offre.prix}€</span>
              <span class="text-gray-500 text-base">/nuit</span>
            </div>
          )}
          
          <div class="flex items-center mb-4">
            {offre?.favori && (
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-500" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                    clip-rule="evenodd" />
                </svg>
                <span class="text-gray-600 font-semibold">Favori</span>
              </div>
            )}
          </div>

          <p class="text-gray-700 mb-6">
            Découvrez cette magnifique propriété située à {offre?.adresse}. 
            {offre?.surface && `Une surface de ${offre.surface}m² vous attend.`}
          </p>

          <div class="mb-6">
            <h3 class="text-lg font-semibold mb-2">Caractéristiques:</h3>
            <ul class="list-disc list-inside text-gray-700 space-y-2">
              {offre?.surface && <li>Surface: {offre.surface} m²</li>}
              {offre?.nbChambres && <li>{offre.nbChambres} chambre{offre.nbChambres > 1 ? 's' : ''}</li>}
              {offre?.nbSdb && <li>{offre.nbSdb} salle{offre.nbSdb > 1 ? 's' : ''} de bain</li>}
            </ul>
          </div>

          <div class="flex space-x-4 mb-6">
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function changeImage(src) {
      document.getElementById('mainImage').src = src;
    }
  </script>
</Layout>